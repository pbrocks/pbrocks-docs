
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Channels Â· FeathersJS</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-feathers-versions/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="errors.html" />
    
    
    <link rel="prev" href="events.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../guides/readme.html">
            
                <a href="../guides/readme.html">
            
                    
                    Guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../guides/basics/readme.html">
            
                <a href="../guides/basics/readme.html">
            
                    
                    The Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../guides/basics/setup.html">
            
                <a href="../guides/basics/setup.html">
            
                    
                    Setting up
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../guides/basics/starting.html">
            
                <a href="../guides/basics/starting.html">
            
                    
                    Getting started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../guides/basics/services.html">
            
                <a href="../guides/basics/services.html">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../guides/basics/hooks.html">
            
                <a href="../guides/basics/hooks.html">
            
                    
                    Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="../guides/basics/rest.html">
            
                <a href="../guides/basics/rest.html">
            
                    
                    REST APIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.6" data-path="../guides/basics/databases.html">
            
                <a href="../guides/basics/databases.html">
            
                    
                    Databases
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.7" data-path="../guides/basics/real-time.html">
            
                <a href="../guides/basics/real-time.html">
            
                    
                    Real-time APIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.8" data-path="../guides/basics/clients.html">
            
                <a href="../guides/basics/clients.html">
            
                    
                    Clients
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.9" data-path="../guides/basics/generator.html">
            
                <a href="../guides/basics/generator.html">
            
                    
                    The generator (CLI)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../guides/chat/readme.html">
            
                <a href="../guides/chat/readme.html">
            
                    
                    A Chat Application
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../guides/chat/creating.html">
            
                <a href="../guides/chat/creating.html">
            
                    
                    Creating the application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../guides/chat/service.html">
            
                <a href="../guides/chat/service.html">
            
                    
                    Generating a service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../guides/chat/authentication.html">
            
                <a href="../guides/chat/authentication.html">
            
                    
                    Adding authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../guides/chat/processing.html">
            
                <a href="../guides/chat/processing.html">
            
                    
                    Processing data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../guides/chat/frontend.html">
            
                <a href="../guides/chat/frontend.html">
            
                    
                    Building a frontend
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../guides/chat/testing.html">
            
                <a href="../guides/chat/testing.html">
            
                    
                    Writing tests
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../guides/frameworks/readme.html">
            
                <a href="../guides/frameworks/readme.html">
            
                    
                    Frameworks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../guides/auth/readme.html">
            
                <a href="../guides/auth/readme.html">
            
                    
                    Authentication
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../guides/auth/how-jwt-works.html">
            
                <a href="../guides/auth/how-jwt-works.html">
            
                    
                    How JWT works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../guides/auth/recipe.express-middleware.html">
            
                <a href="../guides/auth/recipe.express-middleware.html">
            
                    
                    Recipe: Express middleware (SSR)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../guides/auth/recipe.customize-response.html">
            
                <a href="../guides/auth/recipe.customize-response.html">
            
                    
                    Recipe: Custom Login Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../guides/auth/recipe.customize-jwt-payload.html">
            
                <a href="../guides/auth/recipe.customize-jwt-payload.html">
            
                    
                    Recipe: Custom JWT Payload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.5" data-path="../guides/auth/recipe.mixed-auth.html">
            
                <a href="../guides/auth/recipe.mixed-auth.html">
            
                    
                    Recipe: Mixed Auth Endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.6" data-path="../guides/auth/recipe.oauth-basic.html">
            
                <a href="../guides/auth/recipe.oauth-basic.html">
            
                    
                    Recipe: Basic OAuth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.7" data-path="../guides/auth/recipe.custom-auth-strategy.html">
            
                <a href="../guides/auth/recipe.custom-auth-strategy.html">
            
                    
                    Recipe: Custom Auth Strategies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../guides/advanced/readme.html">
            
                <a href="../guides/advanced/readme.html">
            
                    
                    Advanced Topics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../guides/advanced/file-uploading.html">
            
                <a href="../guides/advanced/file-uploading.html">
            
                    
                    Uploading files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../guides/advanced/using-a-view-engine.html">
            
                <a href="../guides/advanced/using-a-view-engine.html">
            
                    
                    Using a view engine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="../guides/advanced/scaling.html">
            
                <a href="../guides/advanced/scaling.html">
            
                    
                    Scaling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.4" data-path="../guides/advanced/creating-a-plugin.html">
            
                <a href="../guides/advanced/creating-a-plugin.html">
            
                    
                    Creating a plugin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="readme.html">
            
                <a href="readme.html">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    Core
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="application.html">
            
                <a href="application.html">
            
                    
                    Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="services.html">
            
                <a href="services.html">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="hooks.html">
            
                <a href="hooks.html">
            
                    
                    Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="events.html">
            
                <a href="events.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.1.5" data-path="channels.html">
            
                <a href="channels.html">
            
                    
                    Channels
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="errors.html">
            
                <a href="errors.html">
            
                    
                    Errors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.7" data-path="configuration.html">
            
                <a href="configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    Transports
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="express.html">
            
                <a href="express.html">
            
                    
                    Express
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="socketio.html">
            
                <a href="socketio.html">
            
                    
                    Socket.io
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="primus.html">
            
                <a href="primus.html">
            
                    
                    Primus
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" >
            
                <span>
            
                    
                    Client
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="client.html">
            
                <a href="client.html">
            
                    
                    Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="client/rest.html">
            
                <a href="client/rest.html">
            
                    
                    REST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="client/socketio.html">
            
                <a href="client/socketio.html">
            
                    
                    Socket.io
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="client/primus.html">
            
                <a href="client/primus.html">
            
                    
                    Primus
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    Authentication
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="authentication/server.html">
            
                <a href="authentication/server.html">
            
                    
                    Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="authentication/client.html">
            
                <a href="authentication/client.html">
            
                    
                    Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="authentication/local.html">
            
                <a href="authentication/local.html">
            
                    
                    Local
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.4" data-path="authentication/jwt.html">
            
                <a href="authentication/jwt.html">
            
                    
                    JWT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.5" data-path="authentication/oauth1.html">
            
                <a href="authentication/oauth1.html">
            
                    
                    OAuth1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.6" data-path="authentication/oauth2.html">
            
                <a href="authentication/oauth2.html">
            
                    
                    OAuth2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" >
            
                <span>
            
                    
                    Database
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="databases/adapters.html">
            
                <a href="databases/adapters.html">
            
                    
                    Adapters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.2" data-path="databases/common.html">
            
                <a href="databases/common.html">
            
                    
                    Common API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.3" data-path="databases/querying.html">
            
                <a href="databases/querying.html">
            
                    
                    Querying
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../migrating.html">
            
                <a href="../migrating.html">
            
                    
                    Migrating
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../SECURITY.html">
            
                <a href="../SECURITY.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <a target="_blank" href="https://github.com/feathersjs/awesome-feathersjs">
            
                    
                    Ecosystem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../help/readme.html">
            
                <a href="../help/readme.html">
            
                    
                    Help
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../faq/readme.html">
            
                <a href="../faq/readme.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../contributing/readme.html">
            
                <a href="../contributing/readme.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../license.html">
            
                <a href="../license.html">
            
                    
                    License
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Channels</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
  
                                <h1 id="event-channels">Event channels</h1>
<p>On a Feathers server with a real-time transport (<a href="socketio.html">Socket.io</a> or <a href="primus.html">Primus</a>) set up, event channels determine which connected clients to send <a href="events.html">real-time events</a> to and how the sent data should look like.</p>
<p>This chapter describes:</p>
<ul>
<li><a href="#connections">Real-time Connections</a> and how to access them</li>
<li><a href="#channels">Channel usage</a> and how to retrieve, join and leave channels</li>
<li><a href="#publishing">Publishing events</a> to channels</li>
</ul>
<blockquote>
<p><strong>Important:</strong> If you are not using a real-time transport server (e.g. when making a REST only API or using Feathers on the client), channel functionality is not going to be available.</p>
</blockquote>
<p>Some examples where channels are used:</p>
<ul>
<li>Real-time events should only be sent to authenticated users</li>
<li>Users should only get updates about messages if they joined a certain chat room</li>
<li>Only users in the same organization should receive real-time updates about their data changes</li>
<li>Only admins should be notified when new users are created</li>
<li>When a user is created, modified or removed, non-admins should only receive a &quot;safe&quot; version of the user object (e.g. only <code>email</code>, <code>id</code> and <code>avatar</code>)</li>
</ul>
<h2 id="example">Example</h2>
<p>The example below shows the generated <code>channels.js</code> file illustrating how the different parts fit together:</p>
<pre><code class="lang-js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">app</span>) </span>{
  app.on(<span class="hljs-string">&apos;connection&apos;</span>, connection =&gt; {
    <span class="hljs-comment">// On a new real-time connection, add it to the</span>
    <span class="hljs-comment">// anonymous channel</span>
    app.channel(<span class="hljs-string">&apos;anonymous&apos;</span>).join(connection);
  });

  app.on(<span class="hljs-string">&apos;login&apos;</span>, (payload, { connection }) =&gt; {
    <span class="hljs-comment">// connection can be undefined if there is no</span>
    <span class="hljs-comment">// real-time connection, e.g. when logging in via REST</span>
    <span class="hljs-keyword">if</span>(connection) {
      <span class="hljs-keyword">const</span> { user } = connection;

      <span class="hljs-comment">// The connection is no longer anonymous, remove it</span>
      app.channel(<span class="hljs-string">&apos;anonymous&apos;</span>).leave(connection);

      <span class="hljs-comment">// Add it to the authenticated user channel</span>
      app.channel(<span class="hljs-string">&apos;authenticated&apos;</span>).join(connection);

      <span class="hljs-comment">// Channels can be named anything and joined on any condition </span>
      <span class="hljs-comment">// E.g. to send real-time events only to admins use</span>

      <span class="hljs-comment">// if(user.isAdmin) { app.channel(&apos;admins&apos;).join(connection); }</span>

      <span class="hljs-comment">// If the user has joined e.g. chat rooms</span>

      <span class="hljs-comment">// user.rooms.forEach(room =&gt; app.channel(`rooms/${room.id}`).join(connection))</span>
    }
  });

  <span class="hljs-comment">// A global publisher that sends all events to all authenticated clients</span>
  app.publish((data, context) =&gt; {
    <span class="hljs-keyword">return</span> app.channel(<span class="hljs-string">&apos;authenticated&apos;</span>);
  });
};
</code></pre>
<h2 id="connections">Connections</h2>
<p>A connection is an object that represents a real-time connection. It is the same object as <code>socket.feathers</code> in a <a href="socketio.html">Socket.io</a> and <code>socket.request.feathers</code> in a <a href="primus.html">Primus</a> middleware. You can add any kind of information to it but most notably, when using <a href="authentication/server.html">authentication</a>, it will contain the authenticated user. By default it is located in <code>connection.user</code> once the client has authenticated on the socket (usually by calling <code>app.authenticate()</code> on the <a href="client.html">client</a>).</p>
<p>We can get access to the <code>connection</code> object by listening to <code>app.on(&apos;connection&apos;, connection =&gt; {})</code> or <code>app.on(&apos;login&apos;, (payload, { connection }) =&gt; {})</code>.</p>
<blockquote>
<p><strong>Note:</strong> When a connection is terminated it will be automatically removed from all channels.</p>
</blockquote>
<h3 id="apponconnection">app.on(&apos;connection&apos;)</h3>
<p><code>app.on(&apos;connection&apos;, connection =&gt; {})</code> is fired every time a new real-time connection is established. This is a good place to add the connection to a channel for anonymous users (in case we want to send any real-time updates to them):</p>
<pre><code class="lang-js">app.on(<span class="hljs-string">&apos;connection&apos;</span>, connection =&gt; {
  <span class="hljs-comment">// On a new real-time connection, add it to the</span>
  <span class="hljs-comment">// anonymous channel</span>
  app.channel(<span class="hljs-string">&apos;anonymous&apos;</span>).join(connection);
});
</code></pre>
<h3 id="apponlogin">app.on(&apos;login&apos;)</h3>
<p><code>app.on(&apos;login&apos;, (payload, info) =&gt; {})</code> is sent by the <a href="authentication/server.html">authentication module</a> and also contains the connection in the <code>info</code> object that is passed as the second parameter. Note that it can also be <code>undefined</code> if the login happened through e.g. REST which does not support real-time connectivity. </p>
<p>This is a good place to add the connection to channels related to the user (e.g. chat rooms, admin status etc.)</p>
<pre><code class="lang-js">app.on(<span class="hljs-string">&apos;login&apos;</span>, (payload, { connection }) =&gt; {
  <span class="hljs-comment">// connection can be undefined if there is no</span>
  <span class="hljs-comment">// real-time connection, e.g. when logging in via REST</span>
  <span class="hljs-keyword">if</span>(connection) {
    <span class="hljs-comment">// The user attached to this connection</span>
    <span class="hljs-keyword">const</span> { user } = connection;

    <span class="hljs-comment">// The connection is no longer anonymous, remove it</span>
    app.channel(<span class="hljs-string">&apos;anonymous&apos;</span>).leave(connection);

    <span class="hljs-comment">// Add it to the authenticated user channel</span>
    app.channel(<span class="hljs-string">&apos;authenticated&apos;</span>).join(connection);

    <span class="hljs-comment">// Channels can be named anything and joined on any condition `</span>
    <span class="hljs-comment">// E.g. to send real-time events only to admins use</span>
    <span class="hljs-keyword">if</span>(user.isAdmin) {
      app.channel(<span class="hljs-string">&apos;admins&apos;</span>).join(connection);
    }

    <span class="hljs-comment">// If the user has joined e.g. chat rooms</span>
    user.rooms.forEach(room =&gt; {
      app.channel(<span class="hljs-string">`rooms/<span class="hljs-subst">${room.id}</span>`</span>).join(connection);
    });
  }
});
</code></pre>
<blockquote>
<p><strong>Note:</strong> <code>(user, { connection })</code> is an ES6 shorthand for <code>(user, meta) =&gt; { const connection = meta.connection; }</code>, see <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" target="_blank">Destructuring assignment</a>.</p>
</blockquote>
<h2 id="channels">Channels</h2>
<p>A channel is an object that contains a number of connections. It can be created via <code>app.channel</code> and allows a connection to join or leave it.</p>
<h3 id="appchannelnames">app.channel(...names)</h3>
<p><code>app.channel(name) -&gt; Channel</code>, when given a single name, returns an existing or new named channel:</p>
<pre><code class="lang-js">app.channel(<span class="hljs-string">&apos;admins&apos;</span>) <span class="hljs-comment">// the admin channel</span>
app.channel(<span class="hljs-string">&apos;authenticated&apos;</span>) <span class="hljs-comment">// the authenticated channel</span>
</code></pre>
<p><code>app.channel(name1, name2, ... nameN) -&gt; Channel</code>, when given multiples names, will return a combined channel. A combined channel contains a list of all connections (without duplicates) and re-directs <code>channel.join</code> and <code>channel.leave</code> calls to all its child channels.</p>
<pre><code class="lang-js"><span class="hljs-comment">// Combine the anonymous and authenticated channel</span>
<span class="hljs-keyword">const</span> combinedChannel = app.channel(<span class="hljs-string">&apos;anonymous&apos;</span>, <span class="hljs-string">&apos;authenticated&apos;</span>)

<span class="hljs-comment">// Join the `admins` and `chat` channel</span>
app.channel(<span class="hljs-string">&apos;admins&apos;</span>, <span class="hljs-string">&apos;chat&apos;</span>).join(connection);

<span class="hljs-comment">// Leave the `admins` and `chat` channel</span>
app.channel(<span class="hljs-string">&apos;admins&apos;</span>, <span class="hljs-string">&apos;chat&apos;</span>).leave(connection);

<span class="hljs-comment">// Make user with `_id` 5 leave the admins and chat channel</span>
app.channel(<span class="hljs-string">&apos;admins&apos;</span>, <span class="hljs-string">&apos;chat&apos;</span>).leave(connection =&gt; {
  <span class="hljs-keyword">return</span> connection.user._id === <span class="hljs-number">5</span>;
});
</code></pre>
<h3 id="appchannels">app.channels</h3>
<p><code>app.channels -&gt; [string]</code> returns a list of all existing channel names.</p>
<pre><code class="lang-js">app.channel(<span class="hljs-string">&apos;authenticated&apos;</span>);
app.channel(<span class="hljs-string">&apos;admins&apos;</span>, <span class="hljs-string">&apos;users&apos;</span>);

app.channels <span class="hljs-comment">// [ &apos;authenticated&apos;, &apos;admins&apos;, &apos;users&apos; ]</span>

app.channel(app.channels) <span class="hljs-comment">// will return a channel with all connections</span>
</code></pre>
<p>This is useful to e.g. remove a connection from all channels:</p>
<pre><code class="lang-js"><span class="hljs-comment">// When a user is removed, make all their connections leave every channel</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).on(<span class="hljs-string">&apos;removed&apos;</span>, user =&gt; {
  app.channel(app.channels).leave(connection =&gt; {
    <span class="hljs-keyword">return</span> user._id === connection.user._id;
  });
});
</code></pre>
<h3 id="channeljoinconnection">channel.join(connection)</h3>
<p><code>channel.join(connection) -&gt; Channel</code> adds a connection to this channel. If the channel is a combined channel, add the connection to all its child channels. If the connection is already in the channel it does nothing. Returns the channel object.</p>
<pre><code class="lang-js">app.on(<span class="hljs-string">&apos;login&apos;</span>, (payload, { connection }) =&gt; {
  <span class="hljs-keyword">if</span>(connection &amp;&amp; connection.user.isAdmin) {
    <span class="hljs-comment">// Join the admins channel</span>
    app.channel(<span class="hljs-string">&apos;admins&apos;</span>).join(connection);

    <span class="hljs-comment">// Calling a second time will do nothing</span>
    app.channel(<span class="hljs-string">&apos;admins&apos;</span>).join(connection);
  }
});
</code></pre>
<h3 id="channelleaveconnectionfn">channel.leave(connection|fn)</h3>
<p><code>channel.leave(connection|fn) -&gt; Channel</code> removes a connection from this channel. If the channel is a combined channel, remove the connection from all its child channels. Also allows to pass a callback that is run for every connection and returns if the connection should be removed or not. Returns the channel object.</p>
<pre><code class="lang-js"><span class="hljs-comment">// Make the user with `_id` 5 leave the `admins` channel</span>
app.channel(<span class="hljs-string">&apos;admins&apos;</span>).leave(connection =&gt; {
  <span class="hljs-keyword">return</span> connection.user._id === <span class="hljs-number">5</span>;
});
</code></pre>
<h3 id="channelfilterfn">channel.filter(fn)</h3>
<p><code>channel.filter(fn) -&gt; Channel</code> returns a new channel filtered by a given function which gets passed the connection.</p>
<pre><code class="lang-js"><span class="hljs-comment">// Returns a new channel with all connections of the user with `_id` 5</span>
<span class="hljs-keyword">const</span> userFive = app.channel(app.channels)
  .filter(connection =&gt; connection.user._id === <span class="hljs-number">5</span>);
</code></pre>
<h3 id="channelsenddata">channel.send(data)</h3>
<p><code>channel.send(data) -&gt; Channel</code> returns a copy of this channel with customized data that should be sent for this event. Usually this should be handled by modifying either the service method result or setting client &quot;safe&quot; data in <code>context.dispatch</code> but in some cases it might make sense to still change the event data for certain channels.</p>
<p>What data will be sent as the event data will be determined by the first available in the following order:</p>
<ol>
<li><code>data</code> from <code>channel.send(data)</code></li>
<li><code>context.dispatch</code></li>
<li><code>context.result</code></li>
</ol>
<pre><code class="lang-js">app.on(<span class="hljs-string">&apos;connection&apos;</span>, connection =&gt; {
  <span class="hljs-comment">// On a new real-time connection, add it to the</span>
  <span class="hljs-comment">// anonymous channel</span>
  app.channel(<span class="hljs-string">&apos;anonymous&apos;</span>).join(connection);
});

<span class="hljs-comment">// Send the `users` `created` event to all anonymous</span>
<span class="hljs-comment">// users but use only the name as the payload</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).publish(<span class="hljs-string">&apos;created&apos;</span>, data =&gt; {
  <span class="hljs-keyword">return</span> app.channel(<span class="hljs-string">&apos;anonymous&apos;</span>).send({
    name: data.name
  });
});
</code></pre>
<blockquote>
<p><strong>Note:</strong> If a connection is in multiple channels (e.g. <code>users</code> and <code>admins</code>) it will get the data from the <em>first</em> channel that it is in.</p>
</blockquote>
<h3 id="channelconnections">channel.connections</h3>
<p><code>channel.connections -&gt; [ object ]</code> contains a list of all connections in this channel.</p>
<h3 id="channellength">channel.length</h3>
<p><code>channel.length -&gt; integer</code> returns the total number of connections in this channel.</p>
<h2 id="publishing">Publishing</h2>
<p>Publishers are callback functions that return which channel(s) to send an event to. They can be registered at the application and the service level and for all or specific events. A publishing function gets the event data and context object (<code>(data, context) =&gt; {}</code>) and returns a named or combined channel, an array of channels or <code>null</code>. Only one publisher can be registered for one type. Besides the standard <a href="events.html#service-events">service event names</a> an event name can also be a <a href="events.html#custom-events">custom event</a>. <code>context</code> is the <a href="hooks.html">context object</a> from the service call or an object containing <code>{ path, service, app, result }</code> for custom events.</p>
<h3 id="servicepublishevent-fn">service.publish([event,] fn)</h3>
<p><code>service.publish([event,] fn) -&gt; service</code> registers a publishing function for a specific service for a specific event or all events if no event name was given.</p>
<pre><code class="lang-js">app.on(<span class="hljs-string">&apos;login&apos;</span>, (payload, { connection }) =&gt; {
  <span class="hljs-comment">// connection can be undefined if there is no</span>
  <span class="hljs-comment">// real-time connection, e.g. when logging in via REST</span>
  <span class="hljs-keyword">if</span>(connection &amp;&amp; connection.user.isAdmin) {
    app.channel(<span class="hljs-string">&apos;admins&apos;</span>).join(connection);
  }
});

<span class="hljs-comment">// Publish all messages service events only to its room channel</span>
app.service(<span class="hljs-string">&apos;messages&apos;</span>).publish((data, context) =&gt; {
  <span class="hljs-keyword">return</span> app.channel(<span class="hljs-string">`rooms/<span class="hljs-subst">${data.roomId}</span>`</span>);
});

<span class="hljs-comment">// Publish the `created` event to admins and the user that sent it</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).publish(<span class="hljs-string">&apos;created&apos;</span>, (data, context) =&gt; {
  <span class="hljs-keyword">return</span> [
    app.channel(<span class="hljs-string">&apos;admins&apos;</span>),
    app.channel(app.channels).filter(connection =&gt;
      connection.user._id === context.params.user._id
    )
  ];
});

<span class="hljs-comment">// Prevent all events in the `password-reset` service from being published</span>
app.service(<span class="hljs-string">&apos;password-reset&apos;</span>).publish(() =&gt; <span class="hljs-literal">null</span>);
</code></pre>
<h3 id="apppublishevent-fn">app.publish([event,] fn)</h3>
<p><code>app.publish([event,] fn) -&gt; app</code> registers a publishing function for all services for a specific event or all events if no event name was given.</p>
<pre><code class="lang-js">app.on(<span class="hljs-string">&apos;login&apos;</span>, (payload, { connection }) =&gt; {
  <span class="hljs-comment">// connection can be undefined if there is no</span>
  <span class="hljs-comment">// real-time connection, e.g. when logging in via REST</span>
  <span class="hljs-keyword">if</span>(connection) {
    app.channel(<span class="hljs-string">&apos;authenticated&apos;</span>).join(connection);
  }
});

<span class="hljs-comment">// Publish all events to all authenticated users</span>
app.publish((data, context) =&gt; {
  <span class="hljs-keyword">return</span> app.channel(<span class="hljs-string">&apos;authenticated&apos;</span>);
});

<span class="hljs-comment">// Publish the `log` custom event to all connections</span>
app.publish(<span class="hljs-string">&apos;log&apos;</span>, (data, context) =&gt; {
  <span class="hljs-keyword">return</span> app.channel(app.channels);
});
</code></pre>
<h3 id="publisher-precedence">Publisher precedence</h3>
<p>The first publisher callback found in the following order will be used:</p>
<ol>
<li>Service publisher for a specific event</li>
<li>Service publisher for all events</li>
<li>App publishers for a specific event</li>
<li>App publishers for all events</li>
</ol>
<h2 id="keeping-channels-updated">Keeping channels updated</h2>
<p>Since every application will be different, keeping the connections assigned to channels up to date (e.g. if a user joins/leaves a room) is up to you.</p>
<p>In general, channels should reflect your persistent application data. This means that it normally isn&apos;t necessary for e.g. a user to request to directly join a channel. This is especially important when running multiple instances of an application since channels are only <em>local</em> to the current instance.</p>
<p>Instead, the relevant information (e.g. what rooms a user is currently in) should be stored in the database and then the active connections can be re-distributed into the appropriate channels listening to the proper <a href="events.html">service events</a>.</p>
<p>The following example updates all active connections for a given user when the user object (which is assumed to have a <code>rooms</code> array being a list of room ids the user has joined) is updated or removed:</p>
<pre><code class="lang-js"><span class="hljs-comment">// Join a channel given a user and connection</span>
<span class="hljs-keyword">const</span> joinChannels = (user, connection) =&gt; {
  app.channel(<span class="hljs-string">&apos;authenticated&apos;</span>).join(connection);
  <span class="hljs-comment">// Assuming that the chat room/user assignment is stored</span>
  <span class="hljs-comment">// on an array of the user</span>
  user.rooms.forEach(room =&gt;
    app.channel(<span class="hljs-string">`rooms/<span class="hljs-subst">${roomId}</span>`</span>).join(connection)
  );
}

<span class="hljs-comment">// Get a user to leave all channels</span>
<span class="hljs-keyword">const</span> leaveChannels = user =&gt; {
  app.channel(app.channels).leave(connection =&gt;
    connection.user._id === user._id
  );
};

<span class="hljs-comment">// Leave and re-join all channels with new user information</span>
<span class="hljs-keyword">const</span> updateChannels = user =&gt; {
  <span class="hljs-comment">// Find all connections for this user</span>
  <span class="hljs-keyword">const</span> { connections } = app.channel(app.channels).filter(connection =&gt;
    connection.user._id === user._id
  );

  <span class="hljs-comment">// Leave all channels</span>
  leaveChannels(user);

  <span class="hljs-comment">// Re-join all channels with the updated user information</span>
  connections.forEach(connection =&gt; joinChannels(user, connection));
}

app.on(<span class="hljs-string">&apos;login&apos;</span>, (payload, { connection }) =&gt; {
  <span class="hljs-keyword">if</span>(connection) {
    <span class="hljs-comment">// Join all channels on login</span>
    joinChannels(connection.user, connection);
  }
});

<span class="hljs-comment">// On `updated` and `patched`, leave and re-join with new room assignments</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).on(<span class="hljs-string">&apos;updated&apos;</span>, updateChannels);
app.service(<span class="hljs-string">&apos;users&apos;</span>).on(<span class="hljs-string">&apos;patched&apos;</span>, updateChannels);
<span class="hljs-comment">// On `removed`, remove the connection from all channels</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).on(<span class="hljs-string">&apos;removed&apos;</span>, leaveChannels);
</code></pre>
<blockquote>
<p><strong>Note:</strong> The number active connections is usually one (or none) but unless you prevent it explicitly Feathers is not preventing multiple logins of the same user (e.g. with two open browser windows or on a mobile device).</p>
</blockquote>

                                
  <blockquote>
    <p>
        Is anything wrong, unclear, missing?
        <a target="_blank" href="https://github.com/pbrocks/docs/issues/new?title=Comment: Channels (api/channels.md)">Leave a comment</a> or
        <a target="_blank" href="https://github.com/pbrocks/docs/edit/master/api/channels.md">edit this page</a>.
    </p>
  </blockquote>

                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="events.html" class="navigation navigation-prev " aria-label="Previous page: Events">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="errors.html" class="navigation navigation-next " aria-label="Next page: Errors">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Channels","level":"1.3.1.5","depth":3,"next":{"title":"Errors","level":"1.3.1.6","depth":3,"path":"api/errors.md","ref":"api/errors.md","articles":[]},"previous":{"title":"Events","level":"1.3.1.4","depth":3,"path":"api/events.md","ref":"api/events.md","articles":[]},"dir":"ltr"},"config":{"plugins":["feathers-collapsible-menu","heading-anchors","include-codeblock","edit-link","feathers-versions","advanced-emoji","codetabs","livereload"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"livereload":{},"search":{},"codetabs":{},"lunr":{"maxIndexSize":1000000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"heading-anchors":{},"highlight":{},"feathers-versions":{},"versions":{"gitbookConfigURL":"https://rawgit.com/feathersjs/feathers-docs/master/book.json","options":[{"value":"https://crow.docs.paidmembershipspro.com","text":"Next version - Crow"},{"value":"https://docs.paidmembershipspro.com","text":"Latest Stable - Buzzard"},{"value":"https://auk.docs.paidmembershipspro.com","text":"Previous release - Auk"},{"value":"https://legacy.docs.paidmembershipspro.com","text":"Legacy"}]},"advanced-emoji":{"embedEmojis":false},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"default","theme":"chrome","unindent":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/pbrocks/docs/edit/master","placement":"left"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"feathers-collapsible-menu":{},"menu":{"deep":true}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"FeathersJS","gitbook":"*"},"file":{"path":"api/channels.md","mtime":"2018-10-21T12:11:38.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-10-21T18:29:49.010Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-feathers-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-feathers-versions/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

