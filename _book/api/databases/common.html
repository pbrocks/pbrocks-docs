
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Common API Â· FeathersJS</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-feathers-versions/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="querying.html" />
    
    
    <link rel="prev" href="adapters.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../guides/readme.html">
            
                <a href="../../guides/readme.html">
            
                    
                    Guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../guides/basics/readme.html">
            
                <a href="../../guides/basics/readme.html">
            
                    
                    The Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../../guides/basics/setup.html">
            
                <a href="../../guides/basics/setup.html">
            
                    
                    Setting up
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../../guides/basics/starting.html">
            
                <a href="../../guides/basics/starting.html">
            
                    
                    Getting started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../../guides/basics/services.html">
            
                <a href="../../guides/basics/services.html">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../../guides/basics/hooks.html">
            
                <a href="../../guides/basics/hooks.html">
            
                    
                    Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="../../guides/basics/rest.html">
            
                <a href="../../guides/basics/rest.html">
            
                    
                    REST APIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.6" data-path="../../guides/basics/databases.html">
            
                <a href="../../guides/basics/databases.html">
            
                    
                    Databases
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.7" data-path="../../guides/basics/real-time.html">
            
                <a href="../../guides/basics/real-time.html">
            
                    
                    Real-time APIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.8" data-path="../../guides/basics/clients.html">
            
                <a href="../../guides/basics/clients.html">
            
                    
                    Clients
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.9" data-path="../../guides/basics/generator.html">
            
                <a href="../../guides/basics/generator.html">
            
                    
                    The generator (CLI)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../guides/chat/readme.html">
            
                <a href="../../guides/chat/readme.html">
            
                    
                    A Chat Application
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../../guides/chat/creating.html">
            
                <a href="../../guides/chat/creating.html">
            
                    
                    Creating the application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../../guides/chat/service.html">
            
                <a href="../../guides/chat/service.html">
            
                    
                    Generating a service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../../guides/chat/authentication.html">
            
                <a href="../../guides/chat/authentication.html">
            
                    
                    Adding authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../../guides/chat/processing.html">
            
                <a href="../../guides/chat/processing.html">
            
                    
                    Processing data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../../guides/chat/frontend.html">
            
                <a href="../../guides/chat/frontend.html">
            
                    
                    Building a frontend
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../../guides/chat/testing.html">
            
                <a href="../../guides/chat/testing.html">
            
                    
                    Writing tests
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../guides/frameworks/readme.html">
            
                <a href="../../guides/frameworks/readme.html">
            
                    
                    Frameworks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../guides/auth/readme.html">
            
                <a href="../../guides/auth/readme.html">
            
                    
                    Authentication
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../../guides/auth/how-jwt-works.html">
            
                <a href="../../guides/auth/how-jwt-works.html">
            
                    
                    How JWT works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../../guides/auth/recipe.express-middleware.html">
            
                <a href="../../guides/auth/recipe.express-middleware.html">
            
                    
                    Recipe: Express middleware (SSR)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../../guides/auth/recipe.customize-response.html">
            
                <a href="../../guides/auth/recipe.customize-response.html">
            
                    
                    Recipe: Custom Login Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../../guides/auth/recipe.customize-jwt-payload.html">
            
                <a href="../../guides/auth/recipe.customize-jwt-payload.html">
            
                    
                    Recipe: Custom JWT Payload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.5" data-path="../../guides/auth/recipe.mixed-auth.html">
            
                <a href="../../guides/auth/recipe.mixed-auth.html">
            
                    
                    Recipe: Mixed Auth Endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.6" data-path="../../guides/auth/recipe.oauth-basic.html">
            
                <a href="../../guides/auth/recipe.oauth-basic.html">
            
                    
                    Recipe: Basic OAuth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.7" data-path="../../guides/auth/recipe.custom-auth-strategy.html">
            
                <a href="../../guides/auth/recipe.custom-auth-strategy.html">
            
                    
                    Recipe: Custom Auth Strategies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../../guides/advanced/readme.html">
            
                <a href="../../guides/advanced/readme.html">
            
                    
                    Advanced Topics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../../guides/advanced/file-uploading.html">
            
                <a href="../../guides/advanced/file-uploading.html">
            
                    
                    Uploading files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../../guides/advanced/using-a-view-engine.html">
            
                <a href="../../guides/advanced/using-a-view-engine.html">
            
                    
                    Using a view engine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="../../guides/advanced/scaling.html">
            
                <a href="../../guides/advanced/scaling.html">
            
                    
                    Scaling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.4" data-path="../../guides/advanced/creating-a-plugin.html">
            
                <a href="../../guides/advanced/creating-a-plugin.html">
            
                    
                    Creating a plugin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../readme.html">
            
                <a href="../readme.html">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    Core
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../application.html">
            
                <a href="../application.html">
            
                    
                    Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../services.html">
            
                <a href="../services.html">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../hooks.html">
            
                <a href="../hooks.html">
            
                    
                    Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../events.html">
            
                <a href="../events.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../channels.html">
            
                <a href="../channels.html">
            
                    
                    Channels
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="../errors.html">
            
                <a href="../errors.html">
            
                    
                    Errors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.7" data-path="../configuration.html">
            
                <a href="../configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    Transports
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../express.html">
            
                <a href="../express.html">
            
                    
                    Express
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../socketio.html">
            
                <a href="../socketio.html">
            
                    
                    Socket.io
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../primus.html">
            
                <a href="../primus.html">
            
                    
                    Primus
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" >
            
                <span>
            
                    
                    Client
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../client.html">
            
                <a href="../client.html">
            
                    
                    Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../client/rest.html">
            
                <a href="../client/rest.html">
            
                    
                    REST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="../client/socketio.html">
            
                <a href="../client/socketio.html">
            
                    
                    Socket.io
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="../client/primus.html">
            
                <a href="../client/primus.html">
            
                    
                    Primus
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    Authentication
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../authentication/server.html">
            
                <a href="../authentication/server.html">
            
                    
                    Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../authentication/client.html">
            
                <a href="../authentication/client.html">
            
                    
                    Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../authentication/local.html">
            
                <a href="../authentication/local.html">
            
                    
                    Local
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.4" data-path="../authentication/jwt.html">
            
                <a href="../authentication/jwt.html">
            
                    
                    JWT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.5" data-path="../authentication/oauth1.html">
            
                <a href="../authentication/oauth1.html">
            
                    
                    OAuth1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.6" data-path="../authentication/oauth2.html">
            
                <a href="../authentication/oauth2.html">
            
                    
                    OAuth2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" >
            
                <span>
            
                    
                    Database
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="adapters.html">
            
                <a href="adapters.html">
            
                    
                    Adapters
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.5.2" data-path="common.html">
            
                <a href="common.html">
            
                    
                    Common API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.3" data-path="querying.html">
            
                <a href="querying.html">
            
                    
                    Querying
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../migrating.html">
            
                <a href="../../migrating.html">
            
                    
                    Migrating
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../SECURITY.html">
            
                <a href="../../SECURITY.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <a target="_blank" href="https://github.com/feathersjs/awesome-feathersjs">
            
                    
                    Ecosystem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../help/readme.html">
            
                <a href="../../help/readme.html">
            
                    
                    Help
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../faq/readme.html">
            
                <a href="../../faq/readme.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../contributing/readme.html">
            
                <a href="../../contributing/readme.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../license.html">
            
                <a href="../../license.html">
            
                    
                    License
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Common API</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
  
                                <h1 id="common-api">Common API</h1>
<p>All database adapters implement a common interface for initialization, pagination, extending and querying. This chapter describes the common adapter initialization and options, how to enable and use pagination, the details on how specific service methods behave and how to extend an adapter with custom functionality.</p>
<blockquote>
<p><strong>Important:</strong> Every database adapter is an implementation of the <a href="../services.html">Feathers service interface</a>. We recommend being familiar with services, service events and hooks before using a database adapter.</p>
</blockquote>
<h2 id="serviceoptions"><code>service([options])</code></h2>
<p>Returns a new service instance initialized with the given options.</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> service = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-&lt;adaptername&gt;&apos;</span>);

app.use(<span class="hljs-string">&apos;/messages&apos;</span>, service());
app.use(<span class="hljs-string">&apos;/messages&apos;</span>, service({ id, events, paginate }));
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>id</code> (<em>optional</em>) - The name of the id field property (usually set by default to <code>id</code> or <code>_id</code>).</li>
<li><code>events</code> (<em>optional</em>) - A list of <a href="../events#custom-events">custom service events</a> sent by this service</li>
<li><code>paginate</code> (<em>optional</em>) - A <a href="#pagination">pagination object</a> containing a <code>default</code> and <code>max</code> page size</li>
</ul>
<h2 id="pagination">Pagination</h2>
<p>When initializing an adapter you can set the following pagination options in the <code>paginate</code> object:</p>
<ul>
<li><code>default</code> - Sets the default number of items when <code>$limit</code> is not set</li>
<li><code>max</code> - Sets the maximum allowed number of items per page (even if the <code>$limit</code> query parameter is set higher)</li>
</ul>
<p>When <code>paginate.default</code> is set, <code>find</code> will return an <em>page object</em> (instead of the normal array) in the following form:</p>
<pre><code>{
  &quot;total&quot;: &quot;&lt;total number of records&gt;&quot;,
  &quot;limit&quot;: &quot;&lt;max number of items per page&gt;&quot;,
  &quot;skip&quot;: &quot;&lt;number of skipped items (offset)&gt;&quot;,
  &quot;data&quot;: [/* data */]
}
</code></pre><p>The pagination options can be set as follows:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> service = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-&lt;db-name&gt;&apos;</span>);

<span class="hljs-comment">// Set the `paginate` option during initialization</span>
app.use(<span class="hljs-string">&apos;/todos&apos;</span>, service({
  paginate: {
    <span class="hljs-keyword">default</span>: <span class="hljs-number">5</span>,
    max: <span class="hljs-number">25</span>
  }
}));

<span class="hljs-comment">// override pagination in `params.paginate` for this call</span>
app.service(<span class="hljs-string">&apos;todos&apos;</span>).find({
  paginate: {
    <span class="hljs-keyword">default</span>: <span class="hljs-number">100</span>,
    max: <span class="hljs-number">200</span>
  }
});

<span class="hljs-comment">// disable pagination for this call</span>
app.service(<span class="hljs-string">&apos;todos&apos;</span>).find({
  paginate: <span class="hljs-literal">false</span>
});
</code></pre>
<blockquote>
<p><strong>Note:</strong> Disabling or changing the default pagination is not available in the client. Only <code>params.query</code> is passed to the server (also see a <a href="https://github.com/feathersjs/feathers/issues/382#issuecomment-238407741" target="_blank">workaround here</a>)</p>
<p><strong>Pro tip:</strong> To just get the number of available records set <code>$limit</code> to <code>0</code>. This will only run a (fast) counting query against the database.</p>
</blockquote>
<h2 id="service-methods">Service methods</h2>
<p>This section describes specifics on how the <a href="../services.html">service methods</a> are implemented for all adapters.</p>
<h3 id="adaptermodel">adapter.Model</h3>
<p>If the ORM or database supports models, the model instance or reference to the collection belonging to this adapter can be found in <code>adapter.Model</code>. This allows to easily make custom queries using that model, e.g. in a hook:</p>
<pre><code class="lang-js"><span class="hljs-comment">// Make a MongoDB aggregation (`messages` is using `feathers-mongodb`)</span>
app.service(<span class="hljs-string">&apos;messages&apos;</span>).hooks({
  before: {
    <span class="hljs-keyword">async</span> find(context) {
      <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> service.Model.aggregate([
        { $match: {item_id: id} }, {
          $group: {_id: <span class="hljs-literal">null</span>, total_quantity: {$sum: <span class="hljs-string">&apos;$quantity&apos;</span>} }
        }
      ]).toArray();

      <span class="hljs-comment">// Do something with results</span>

      <span class="hljs-keyword">return</span> context;
    }
  }
});
</code></pre>
<h3 id="adapterfindparams">adapter.find(params)</h3>
<p><code>adapter.find(params) -&gt; Promise</code> returns a list of all records matching the query in <code>params.query</code> using the <a href="querying.html">common querying mechanism</a>. Will either return an array with the results or a page object if <a href="#pagination">pagination is enabled</a>.</p>
<blockquote>
<p><strong>Important</strong>: When used via REST URLs all query values are strings. Depending on the database the values in <code>params.query</code> might have to be converted to the right type in a <a href="../hooks.html">before hook</a>.</p>
</blockquote>
<pre><code class="lang-js"><span class="hljs-comment">// Find all messages for user with id 1</span>
app.service(<span class="hljs-string">&apos;messages&apos;</span>).find({
  query: {
    userId: <span class="hljs-number">1</span>
  }
}).then(messages =&gt; <span class="hljs-built_in">console</span>.log(messages));

<span class="hljs-comment">// Find all messages belonging to room 1 or 3</span>
app.service(<span class="hljs-string">&apos;messages&apos;</span>).find({
  query: {
    roomId: {
      $<span class="hljs-keyword">in</span>: [ <span class="hljs-number">1</span>, <span class="hljs-number">3</span> ]
    }
  }
}).then(messages =&gt; <span class="hljs-built_in">console</span>.log(messages));
</code></pre>
<p>Find all messages for user with id 1</p>
<pre><code>GET /messages?userId=1
</code></pre><p>Find all messages belonging to room 1 or 3</p>
<pre><code>GET /messages?roomId[$in]=1&amp;roomId[$in]=3
</code></pre><h3 id="adaptergetid-params">adapter.get(id, params)</h3>
<p><code>adapter.get(id, params) -&gt; Promise</code> retrieves a single record by its unique identifier (the field set in the <code>id</code> option during initialization).</p>
<pre><code class="lang-js">app.service(<span class="hljs-string">&apos;messages&apos;</span>).get(<span class="hljs-number">1</span>)
  .then(message =&gt; <span class="hljs-built_in">console</span>.log(message));
</code></pre>
<pre><code>GET /messages/1
</code></pre><h3 id="adaptercreatedata-params">adapter.create(data, params)</h3>
<p><code>adapter.create(data, params) -&gt; Promise</code> creates a new record with <code>data</code>. <code>data</code> can also be an array to create multiple records.</p>
<pre><code class="lang-js">app.service(<span class="hljs-string">&apos;messages&apos;</span>).create({
    text: <span class="hljs-string">&apos;A test message&apos;</span>
  })
  .then(message =&gt; <span class="hljs-built_in">console</span>.log(message));

app.service(<span class="hljs-string">&apos;messages&apos;</span>).create([{
    text: <span class="hljs-string">&apos;Hi&apos;</span>
  }, {
    text: <span class="hljs-string">&apos;How are you&apos;</span>
  }])
  .then(messages =&gt; <span class="hljs-built_in">console</span>.log(messages));
</code></pre>
<pre><code>POST /messages
{
  &quot;text&quot;: &quot;A test message&quot;
}
</code></pre><h3 id="adapterupdateid-data-params">adapter.update(id, data, params)</h3>
<p><code>adapter.update(id, data, params) -&gt; Promise</code> completely replaces a single record identified by <code>id</code> with <code>data</code>. Does not allow replacing multiple records (<code>id</code> can&apos;t be <code>null</code>). <code>id</code> can not be changed.</p>
<pre><code class="lang-js">app.service(<span class="hljs-string">&apos;messages&apos;</span>).update(<span class="hljs-number">1</span>, {
    text: <span class="hljs-string">&apos;Updates message&apos;</span>
  })
  .then(message =&gt; <span class="hljs-built_in">console</span>.log(message));
</code></pre>
<pre><code>PUT /messages/1
{ &quot;text&quot;: &quot;Updated message&quot; }
</code></pre><h3 id="adapterpatchid-data-params">adapter.patch(id, data, params)</h3>
<p><code>adapter.patch(id, data, params) -&gt; Promise</code> merges a record identified by <code>id</code> with <code>data</code>. <code>id</code> can be <code>null</code> to allow replacing multiple records (all records that match <code>params.query</code> the same as in <code>.find</code>). <code>id</code> can not be changed.</p>
<pre><code class="lang-js">app.service(<span class="hljs-string">&apos;messages&apos;</span>).patch(<span class="hljs-number">1</span>, {
  text: <span class="hljs-string">&apos;A patched message&apos;</span>
}).then(message =&gt; <span class="hljs-built_in">console</span>.log(message));

<span class="hljs-keyword">const</span> params = {
  query: { read: <span class="hljs-literal">false</span> }
};

<span class="hljs-comment">// Mark all unread messages as read</span>
app.service(<span class="hljs-string">&apos;messages&apos;</span>).patch(<span class="hljs-literal">null</span>, {
  read: <span class="hljs-literal">true</span>
}, params);
</code></pre>
<pre><code>PATCH /messages/1
{ &quot;text&quot;: &quot;A patched message&quot; }
</code></pre><p>Mark all unread messages as read</p>
<pre><code>PATCH /messages?read=false
{ &quot;read&quot;: true }
</code></pre><h3 id="adapterremoveid-params">adapter.remove(id, params)</h3>
<p><code>adapter.remove(id, params) -&gt; Promise</code> removes a record identified by <code>id</code>. <code>id</code> can be <code>null</code> to allow removing multiple records (all records that match <code>params.query</code> the same as in <code>.find</code>).</p>
<pre><code class="lang-js">app.service(<span class="hljs-string">&apos;messages&apos;</span>).remove(<span class="hljs-number">1</span>)
  .then(message =&gt; <span class="hljs-built_in">console</span>.log(message));

<span class="hljs-keyword">const</span> params = {
  query: { read: <span class="hljs-literal">true</span> }
};

<span class="hljs-comment">// Remove all read messages</span>
app.service(<span class="hljs-string">&apos;messages&apos;</span>).remove(<span class="hljs-literal">null</span>, params);
</code></pre>
<pre><code>DELETE /messages/1
</code></pre><p>Remove all read messages</p>
<pre><code>DELETE /messages?read=true
</code></pre><h2 id="extending-adapters">Extending Adapters</h2>
<p>There are two ways to extend existing database adapters. Either by extending the ES6 base class or by adding functionality through hooks.</p>
<blockquote>
<p><strong>ProTip:</strong> Keep in mind that calling the original service methods will return a Promise that resolves with the value.</p>
</blockquote>
<h3 id="hooks">Hooks</h3>
<p>The most flexible option is weaving in functionality through <a href="../hooks.html">hooks</a>. For example, <code>createdAt</code> and <code>updatedAt</code> timestamps could be added like this:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> feathers = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;@feathersjs/feathers&apos;</span>);

<span class="hljs-comment">// Import the database adapter of choice</span>
<span class="hljs-keyword">const</span> service = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-&lt;adapter&gt;&apos;</span>);

<span class="hljs-keyword">const</span> app = feathers().use(<span class="hljs-string">&apos;/todos&apos;</span>, service({
  paginate: {
    <span class="hljs-keyword">default</span>: <span class="hljs-number">2</span>,
    max: <span class="hljs-number">4</span>
  }
}));

app.service(<span class="hljs-string">&apos;todos&apos;</span>).hooks({
  before: {
    create: [
      (context) =&gt; context.data.createdAt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
    ],

    update: [
      (context) =&gt; context.data.updatedAt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
    ]
  }
});

app.listen(<span class="hljs-number">3030</span>);
</code></pre>
<h3 id="classes-es6">Classes (ES6)</h3>
<p>All modules also export an <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Classes" target="_blank">ES6 class</a> as <code>Service</code> that can be directly extended like this:</p>
<pre><code class="lang-js"><span class="hljs-meta">&apos;use strict&apos;</span>;

<span class="hljs-keyword">const</span> { Service } = <span class="hljs-built_in">require</span>( <span class="hljs-string">&apos;feathers-&lt;database&gt;&apos;</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Service</span> </span>{
  create(data, params) {
    data.created_at = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.create(data, params);
  }

  update(id, data, params) {
    data.updated_at = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.update(id, data, params);
  }
}

app.use(<span class="hljs-string">&apos;/todos&apos;</span>, <span class="hljs-keyword">new</span> MyService({
  paginate: {
    <span class="hljs-keyword">default</span>: <span class="hljs-number">2</span>,
    max: <span class="hljs-number">4</span>
  }
}));
</code></pre>

                                
  <blockquote>
    <p>
        Is anything wrong, unclear, missing?
        <a target="_blank" href="https://github.com/pbrocks/docs/issues/new?title=Comment: Common API (api/databases/common.md)">Leave a comment</a> or
        <a target="_blank" href="https://github.com/pbrocks/docs/edit/master/api/databases/common.md">edit this page</a>.
    </p>
  </blockquote>

                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="adapters.html" class="navigation navigation-prev " aria-label="Previous page: Adapters">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="querying.html" class="navigation navigation-next " aria-label="Next page: Querying">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Common API","level":"1.3.5.2","depth":3,"next":{"title":"Querying","level":"1.3.5.3","depth":3,"path":"api/databases/querying.md","ref":"api/databases/querying.md","articles":[]},"previous":{"title":"Adapters","level":"1.3.5.1","depth":3,"path":"api/databases/adapters.md","ref":"api/databases/adapters.md","articles":[]},"dir":"ltr"},"config":{"plugins":["feathers-collapsible-menu","heading-anchors","include-codeblock","edit-link","feathers-versions","advanced-emoji","codetabs","livereload"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"livereload":{},"search":{},"codetabs":{},"lunr":{"maxIndexSize":1000000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"heading-anchors":{},"highlight":{},"feathers-versions":{},"versions":{"gitbookConfigURL":"https://rawgit.com/feathersjs/feathers-docs/master/book.json","options":[{"value":"https://crow.docs.paidmembershipspro.com","text":"Next version - Crow"},{"value":"https://docs.paidmembershipspro.com","text":"Latest Stable - Buzzard"},{"value":"https://auk.docs.paidmembershipspro.com","text":"Previous release - Auk"},{"value":"https://legacy.docs.paidmembershipspro.com","text":"Legacy"}]},"advanced-emoji":{"embedEmojis":false},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"default","theme":"chrome","unindent":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/pbrocks/docs/edit/master","placement":"left"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"feathers-collapsible-menu":{},"menu":{"deep":true}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"FeathersJS","gitbook":"*"},"file":{"path":"api/databases/common.md","mtime":"2018-10-21T12:11:38.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-10-21T18:29:49.010Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-feathers-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-feathers-versions/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

